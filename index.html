<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hockey Scout Sheet</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Upload = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
            </svg>
        );
        
        const Settings = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.2-13.8l-1 1.7m-4.4 7.6l-1 1.7M23 12h-6m-6 0H5m13.8 5.2l-1.7-1m-7.6-4.4l-1.7-1"/>
            </svg>
        );
        
        const Printer = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/>
            </svg>
        );

        const X = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const HockeyLinesChart = () => {
          const [myTeamSetup, setMyTeamSetup] = useState({
            teamName: 'Delano Tigers',
            logo: null,
            colors: { primary: '#fb923c', secondary: '#1f2937' },
            arena: 'Delano Area Sports Arena, Delano',
            careerStats: {},
            pronunciations: {}
          });

          const [myTeamData, setMyTeamData] = useState({
            teamName: '',
            nickname: '',
            record: { w: 0, l: 0, t: 0 },
            section: '2A',
            conference: 'WCC',
            stats: { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 },
            roster: [],
            nextGame: { gameNum: '', opponent: '', date: '', location: '', oppRecord: '', oppSection: '', oppConference: '' },
            headCoach: { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } },
            studentManager: '',
            injuries: []
          });

          const [opponentData, setOpponentData] = useState({
            teamName: '',
            nickname: '',
            record: { w: 0, l: 0, t: 0 },
            section: '',
            conference: '',
            stats: { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 },
            roster: [],
            headCoach: { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } }
          });

          const [lines, setLines] = useState({
            line1: { lw: null, c: null, rw: null, color: 'GREEN' },
            line2: { lw: null, c: null, rw: null, color: 'RED' },
            line3: { lw: null, c: null, rw: null, color: 'BLUE' },
            line4: { lw: null, c: null, rw: null, color: 'YELLOW' },
            d1: { ld: null, rd: null },
            d2: { ld: null, rd: null },
            d3: { ld: null, rd: null },
            goalies: { starter: null, backup: null }
          });

          const [coachNotes, setCoachNotes] = useState({
            pk: '',
            pp: '',
            scoutNotes: { powerPlay: '', penaltyKill: '', keyPlayers: '' },
            showScoutNotes: true
          });

          const [showSetup, setShowSetup] = useState(false);
          const [showImport, setShowImport] = useState(false);
          const [showColorPicker, setShowColorPicker] = useState(false);
          const [importStep, setImportStep] = useState('myTeamHome');
          const [importText, setImportText] = useState('');
          const [draggedPlayer, setDraggedPlayer] = useState(null);
          const [dragSource, setDragSource] = useState(null);
          const [opponentLogo, setOpponentLogo] = useState(null);
          const [opponentColors, setOpponentColors] = useState({ primary: '#dc2626', secondary: '#991b1b' });
          const [careerStatsImport, setCareerStatsImport] = useState({
            lastSeason: '',
            twoSeasonsAgo: '',
            threeSeasonsAgo: ''
          });

          const colorOptions = ['GREEN', 'RED', 'BLUE', 'YELLOW'];
          const colorClasses = {
            'GREEN': 'bg-green-100 border-green-600',
            'RED': 'bg-red-100 border-red-600',
            'BLUE': 'bg-blue-100 border-blue-600',
            'YELLOW': 'bg-yellow-100 border-yellow-600'
          };

          const importSteps = [
  { key: 'myTeamHome', label: 'My Team - Legacy Home', team: 'mine' },
  { key: 'myTeamRoster', label: 'My Team - Legacy Roster', team: 'mine' },
  { key: 'myTeamSchedule', label: 'My Team - Legacy Game Schedule', team: 'mine' },
  { key: 'myTeamPlayerStats', label: 'My Team - Legacy Player Stats', team: 'mine' },
  { key: 'myTeamTeamStats', label: 'My Team - Legacy Team Stats', team: 'mine' },
  { key: 'oppLogo', label: 'Opponent - Logo', team: 'opponent', isLogo: true },
  { key: 'oppHome', label: 'Opponent - Legacy Home', team: 'opponent' },
  { key: 'oppRoster', label: 'Opponent - Legacy Roster', team: 'opponent' },
  { key: 'oppSchedule', label: 'Opponent - Legacy Game Schedule', team: 'opponent' },
  { key: 'oppPlayerStats', label: 'Opponent - Legacy Player Stats', team: 'opponent' },
  { key: 'oppTeamStats', label: 'Opponent - Legacy Team Stats', team: 'opponent' }
];

          useEffect(() => {
            const saved = localStorage.getItem('myTeamSetup');
            if (saved) {
              setMyTeamSetup(JSON.parse(saved));
            }
          }, []);

          useEffect(() => {
            localStorage.setItem('myTeamSetup', JSON.stringify(myTeamSetup));
          }, [myTeamSetup]);

          const parseHomePage = (text) => {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            let teamName = '';
            let nickname = '';
            let record = { w: 0, l: 0, t: 0 };
            let section = '';
            let conference = '';
            let headCoach = { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } };
            
            // Find team name - look for line that appears between "Subscribe" and "History"
            const subscribeIdx = lines.findIndex(l => l === 'Subscribe');
            const historyIdx = lines.findIndex(l => l === 'History');
            if (subscribeIdx >= 0 && historyIdx > subscribeIdx && historyIdx - subscribeIdx <= 3) {
              teamName = lines[subscribeIdx + 1];
            }
            
            // Find nickname - look for "Nickname:" line
            const nicknameIdx = lines.findIndex(l => l.startsWith('Nickname:'));
            if (nicknameIdx >= 0) {
              nickname = lines[nicknameIdx].split(':')[1]?.trim() || '';
            }
            
            // Look for the team record line - format: "15 11 1" (W L T)
for (let i = 0; i < lines.length; i++) {
  // Look for "Team Record" header followed by the stats
  if (lines[i].includes('Team Record') || lines[i].includes('TeamWLT')) {
    // The next line with 3 numbers is the record
    for (let j = i; j < i + 5; j++) {
      const parts = lines[j]?.split(/\s+/);
      if (parts && parts.length >= 3 && /^\d+$/.test(parts[0]) && /^\d+$/.test(parts[1]) && /^\d+$/.test(parts[2])) {
        record = { w: parseInt(parts[0]), l: parseInt(parts[1]), t: parseInt(parts[2]) };
        break;
      }
    }
    break;
  }
}
            
            const coachIdx = lines.findIndex(l => l.includes('Head Coach'));
            if (coachIdx >= 0 && coachIdx + 1 < lines.length) {
              headCoach.name = lines[coachIdx + 1];
              
              // Look for the career record in the next several lines
              // Format: "11th season, 191-84-5"
              for (let i = coachIdx + 1; i < coachIdx + 6 && i < lines.length; i++) {
                const careerLine = lines[i];
                const careerMatch = careerLine.match(/(\d+)-(\d+)-(\d+)/);
                
                if (careerMatch && careerLine.includes('season')) {
                  // Has career record
                  headCoach.careerRecord = { 
                    w: parseInt(careerMatch[1]), 
                    l: parseInt(careerMatch[2]), 
                    t: parseInt(careerMatch[3]) 
                  };
                  break;
                } else if (careerLine.includes('1st Year') || careerLine.includes('1st year')) {
                  // First year coach - career = current season
                  headCoach.careerRecord = { ...record };
                  break;
                }
              }
              
              // Store current season record
              headCoach.seasonRecord = { ...record };
            }
            
            const sectionIdx = lines.findIndex(l => l.includes('Section:'));
            if (sectionIdx >= 0) section = lines[sectionIdx].split(':')[1]?.trim() || '';
            
            const confIdx = lines.findIndex(l => l.includes('Conference:'));
            if (confIdx >= 0) conference = lines[confIdx].split(':')[1]?.trim() || '';
            
            let stats = { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 };
            for (let i = 0; i < lines.length; i++) {
              const parts = lines[i].split(/\s+/);
              if (parts.length >= 10 && parts[0].match(/\d+/)) {
                stats.gpg = parseFloat(parts[3]) || 0;
                stats.gapg = parseFloat(parts[4]) || 0;
                stats.ppPct = parseFloat(parts[6]) || 0;
                stats.pkPct = parseFloat(parts[9]) || 0;
                break;
              }
            }
            
            return { teamName, nickname, record, section, conference, headCoach, stats };
          };

          const parseRoster = (text) => {
  const lines = text.split('\n').map(l => l.trim()).filter(l => l);
  let roster = [];
  
  // Find where the roster table starts - look for "Number" header
  const headerIdx = lines.findIndex(l => l === 'Number' || l.includes('NumberPhotoName'));
  if (headerIdx === -1) return roster;
  
  // Parse each player - they appear after the header
  for (let i = headerIdx + 1; i < lines.length; i++) {
    // Look for lines that start with a number (jersey number)
    if (lines[i].match(/^\d+$/)) {
      const number = lines[i];
      let name = '';
      let position = '';
      let grade = '';
      
      // Next non-empty lines should be: Name, Pos, Grade, Height, Weight, Shoots, DOB
      let offset = 1;
      
      // Skip photo URLs or image indicators
      while (i + offset < lines.length && (lines[i + offset].includes('http') || lines[i + offset].length === 0)) {
        offset++;
      }
      
      // Get name (may be two lines: first name, last name)
      if (i + offset < lines.length) {
        name = lines[i + offset];
        // Check if next line is also part of name (last name)
        if (i + offset + 1 < lines.length && 
            !['F', 'D', 'G'].includes(lines[i + offset + 1])) {
          name += ' ' + lines[i + offset + 1];
          offset++;
        }
        offset++;
      }
      
      // Get position (F, D, or G)
      if (i + offset < lines.length && ['F', 'D', 'G'].includes(lines[i + offset])) {
        position = lines[i + offset];
        offset++;
      }
      
      // Get grade
      if (i + offset < lines.length && lines[i + offset].match(/^\d+$/)) {
        grade = lines[i + offset];
        offset++;
      }
      
      // If we have valid player data, add to roster
      if (name && position) {
        roster.push({
          id: `${number}-${name.replace(/\s+/g, '-')}`,
          number: number,
          name: name,
          position: position,
          grade: grade,
          stats: { gp: 0, g: 0, a: 0, pts: 0, ppg: 0, ppa: 0, sh: 0, sha: 0, pim: 0 }
        });
      }
    }
  }
  
  return roster;
};

          const parseSchedule = (text) => {
  const lines = text.split('\n').map(l => l.trim());
  let gameNum = 0;
  let nextGame = { gameNum: '', opponent: '', date: '', time: '', location: '', oppRecord: '', oppSection: '', oppConference: '' };
  let lastGame = { gameNum: '', opponent: '', date: '', time: '', location: '', oppRecord: '', oppSection: '', oppConference: '' };
  let foundNextGame = false;
  
  // Parse each game line by line
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    
    // Look for date line (starts with day of week) - only count lines that have game info following
    if (line.match(/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun)/) && i + 1 < lines.length) {
      // Check if this is actually a game (next line should be score or "-")
      const nextLine = lines[i + 1];
      
      // Skip if next line is empty or doesn't look like a score/dash
      if (!nextLine || (!nextLine.includes('-') && !nextLine.match(/^\d+$/))) {
        continue;
      }
      
      gameNum++;
      
      // Extract game details
      const opponentLine = lines[i + 2] || '';
      const locationLine = lines[i + 3] || '';
      
      // Store as last game
      lastGame.gameNum = gameNum.toString();
      lastGame.date = line;
      lastGame.opponent = opponentLine.replace('@', '').trim();
      lastGame.location = locationLine;
      
      // Check if this game hasn't been played yet (score is just "-")
      if (nextLine === '-' && !foundNextGame) {
        // This is the next unplayed game!
        nextGame = { ...lastGame };
        foundNextGame = true;
      }
    }
  }
  
  // If no unplayed game found, return the last game
  return foundNextGame ? nextGame : lastGame;
};

          const parsePlayerStats = (text, existingRoster) => {
  const lines = text.split('\n').map(l => l.trim());
  const updatedRoster = [...existingRoster];
  
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    
    // Skip headers and navigation
    if (!line || line.includes('Skater') || line.includes('Goalie') || line.includes('Printable')) continue;
    
    // Try SKATER pattern: Number + Name + 21 stat fields
    // Example: 12Daniel Halonen2713253813100.0360316322371488886242221.41
    const skaterMatch = line.match(/^(\d+)([A-Za-z\s]+?)(\d+)(\d+)(\d+)(\d+)(\d+)([\d.]+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(-?\d+)(\d+)([\d.]+)/);
    
    if (skaterMatch) {
      const number = skaterMatch[1];
      const player = updatedRoster.find(p => p.number === number && p.position !== 'G');
      
      if (player) {
        player.stats = {
          gp: parseInt(skaterMatch[3]) || 0,
          g: parseInt(skaterMatch[4]) || 0,
          a: parseInt(skaterMatch[5]) || 0,
          pts: parseInt(skaterMatch[6]) || 0,
          ppg: parseInt(skaterMatch[9]) || 0,
          ppa: parseInt(skaterMatch[10]) || 0,
          sh: parseInt(skaterMatch[11]) || 0,
          sha: parseInt(skaterMatch[12]) || 0,
          pim: parseInt(skaterMatch[14]) || 0,
          fow: parseInt(skaterMatch[15]) || 0,
          fol: parseInt(skaterMatch[16]) || 0,
          plusMinus: parseInt(skaterMatch[20]) || 0
        };
      }
      continue;
    }
    
    // Try GOALIE pattern: Number + Name + GP + MIN(has colon) + 9 more stats
    // Example: 1Evan Geyen19929:121360480524282.85.8922
    const goalieMatch = line.match(/^(\d+)([A-Za-z\s]+?)(\d+)([\d:]+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)([\d.]+)(\.?\d+)(\d+)/);
    
    if (goalieMatch) {
      const number = goalieMatch[1];
      const player = updatedRoster.find(p => p.number === number && p.position === 'G');
      
      if (player && player.goalieStats) {
        player.goalieStats = {
          gp: parseInt(goalieMatch[3]) || 0,
          min: goalieMatch[4] || '0:00',
          w: parseInt(goalieMatch[5]) || 0,
          l: parseInt(goalieMatch[6]) || 0,
          t: parseInt(goalieMatch[7]) || 0,
          sog: parseInt(goalieMatch[8]) || 0,
          ga: parseInt(goalieMatch[9]) || 0,
          sv: parseInt(goalieMatch[10]) || 0,
          gaa: parseFloat(goalieMatch[11]) || 0,
          svp: goalieMatch[12] || '.000',
          so: parseInt(goalieMatch[13]) || 0
        };
      }
    }
  }
  
  return updatedRoster;
};

          const parseTeamStats = (text) => {
            console.log('parseTeamStats called with text:', text.substring(0, 200));
            const lines = text.split('\n').map(l => l.trim());
            let stats = { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 };
            
            // Look for the line with team stats - format: Delano 27 4.00 3.15 89 25.8 85 23 72.9
            // We need: GPG (index 2), GAPG (index 3), PP% (index 5), PK% (index 8)
            for (let i = 0; i < lines.length; i++) {
              const parts = lines[i].split(/\s+/);
              
              // Look for line starting with team name and has 9+ fields with the right pattern
              if (parts.length >= 9 && 
                  (parts[0] === 'Delano' || parts[0].includes('Tigers') || /^\d+$/.test(parts[1])) &&
                  parts[2]?.match(/^\d+\.\d+$/) && 
                  parts[3]?.match(/^\d+\.\d+$/)) {
                stats.gpg = parseFloat(parts[2]) || 0;
                stats.gapg = parseFloat(parts[3]) || 0;
                stats.ppPct = parseFloat(parts[5]) || 0;
                stats.pkPct = parseFloat(parts[8]) || 0;
                console.log('Found stats at line:', lines[i]);
                console.log('Parsed stats:', stats);
                break;
              }
            }
            
            console.log('parseTeamStats returning:', stats);
            return stats;
          };

          const handleLogoPaste = async (isSetup, isMyTeam) => {
            try {
              const clipboardItems = await navigator.clipboard.read();
              for (const item of clipboardItems) {
                for (const type of item.types) {
                  if (type.startsWith('image/')) {
                    const blob = await item.getType(type);
                    const reader = new FileReader();
                    reader.onload = (event) => {
                      const logoUrl = event.target.result;
                      
                      if (isSetup) {
                        setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
                      } else if (isMyTeam) {
                        setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
                      } else {
                        setOpponentLogo(logoUrl);
                      }
                    };
                    reader.readAsDataURL(blob);
                    return;
                  }
                }
              }
              alert('No image found in clipboard.');
            } catch (err) {
              alert('Unable to paste. Please use Choose File or copy an image first.');
            }
          };

          const handleLogoUpload = (e, isSetup, isMyTeam) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
              const logoUrl = event.target.result;
              
              if (isSetup) {
                setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
              } else if (isMyTeam) {
                setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
              } else {
                setOpponentLogo(logoUrl);
              }
            };
            reader.readAsDataURL(file);
          };

          const handleImport = () => {
            const text = importText;
            console.log('=== handleImport called ===');
            console.log('Current importStep:', importStep);
            console.log('Text length:', text.length);
            
            if (importStep === 'oppLogo') {
              const currentIdx = importSteps.findIndex(s => s.key === importStep);
              if (currentIdx < importSteps.length - 1) {
                setImportStep(importSteps[currentIdx + 1].key);
              }
              return;
            }
            
            if (importStep === 'myTeamHome') {
  console.log('Parsing Home Page:', text);
  const parsed = parseHomePage(text);
  console.log('Parsed result:', parsed);
  setMyTeamData(prev => ({ ...prev, ...parsed }));
            } else if (importStep === 'myTeamRoster') {
              const roster = parseRoster(text);
              setMyTeamData(prev => ({ ...prev, roster }));
            } else if (importStep === 'myTeamSchedule') {
              const nextGame = parseSchedule(text);
              setMyTeamData(prev => ({ ...prev, nextGame }));
            } else if (importStep === 'myTeamPlayerStats') {
              const updatedRoster = parsePlayerStats(text, myTeamData.roster);
              setMyTeamData(prev => ({ ...prev, roster: updatedRoster }));
            } else if (importStep === 'myTeamTeamStats') {
              console.log('Importing My Team Team Stats');
              const stats = parseTeamStats(text);
              console.log('Setting myTeamData stats to:', stats);
              setMyTeamData(prev => ({ ...prev, stats }));
            } else if (importStep === 'oppHome') {
              const parsed = parseHomePage(text);
              setOpponentData(prev => ({ ...prev, ...parsed }));
            } else if (importStep === 'oppRoster') {
              const roster = parseRoster(text);
              setOpponentData(prev => ({ ...prev, roster }));
            } else if (importStep === 'oppSchedule') {
              const nextGame = parseSchedule(text);
              setOpponentData(prev => ({ ...prev, nextGame }));
            } else if (importStep === 'oppPlayerStats') {
              const updatedRoster = parsePlayerStats(text, opponentData.roster);
              setOpponentData(prev => ({ ...prev, roster: updatedRoster }));
            } else if (importStep === 'oppTeamStats') {
              const stats = parseTeamStats(text);
              setOpponentData(prev => ({ ...prev, stats }));
            }
            
            setImportText('');
            
            const currentIdx = importSteps.findIndex(s => s.key === importStep);
            if (currentIdx < importSteps.length - 1) {
              setImportStep(importSteps[currentIdx + 1].key);
            } else {
              setShowImport(false);
            }
          };

          const handleSkipStep = () => {
            setImportText('');
            const currentIdx = importSteps.findIndex(s => s.key === importStep);
            if (currentIdx < importSteps.length - 1) {
              setImportStep(importSteps[currentIdx + 1].key);
            } else {
              setShowImport(false);
            }
          };

            const handleBackStep = () => {
  setImportText('');
  const currentIdx = importSteps.findIndex(s => s.key === importStep);
  if (currentIdx > 0) {
    setImportStep(importSteps[currentIdx - 1].key);
  }
};

          const handleDragStart = (player, source) => {
            setDraggedPlayer(player);
            setDragSource(source);
          };

          const handleDrop = (line, position) => {
            if (!draggedPlayer) return;

            const newLines = { ...lines };
            
            if (dragSource && dragSource.line) {
              newLines[dragSource.line][dragSource.position] = null;
            }

            const existingPlayer = newLines[line][position];
            newLines[line][position] = draggedPlayer;

            if (existingPlayer && dragSource && dragSource.line) {
              newLines[dragSource.line][dragSource.position] = existingPlayer;
            }

            setLines(newLines);
            setDraggedPlayer(null);
            setDragSource(null);
          };

          const handleLineColorChange = (line, color) => {
            setLines({ ...lines, [line]: { ...lines[line], color } });
          };

          const PlayerCard = ({ player, source, compact = false }) => {
            if (!player) return null;
            
            const isGoalie = player.position === 'G';
            const faceoffPct = player.stats.fow + player.stats.fol > 0 
              ? ((player.stats.fow / (player.stats.fow + player.stats.fol)) * 100).toFixed(1)
              : '0.0';
            
            return (
              <div
                draggable={true}
                onDragStart={() => handleDragStart(player, source)}
                className="bg-white border-2 border-gray-800 rounded p-2 cursor-move hover:shadow-xl transition-all"
                style={{ minWidth: compact ? '140px' : '180px', fontSize: '11px' }}
              >
                <div className="flex gap-2">
                  <div className="text-4xl font-black" style={{ lineHeight: '1' }}>{player.number}</div>
                  <div className="flex-1">
                    <div className="font-bold text-sm leading-tight">{player.firstName}</div>
                    <div className="font-bold text-lg leading-tight">{player.lastName}</div>
                    <div className="text-xs mt-1">
                      <div className="flex justify-between">
                        <span>{player.shoots}</span>
                        <span>{player.grade}th</span>
                      </div>
                      <div className="flex justify-between">
                        <span>{player.stats.pim} PIM</span>
                        <span>+/- ({player.stats.plusMinus})</span>
                      </div>
                      {!compact && !isGoalie && (
                        <>
                          <div className="font-semibold">25-26: {player.stats.gp}GP, {player.stats.g}-{player.stats.a}--{player.stats.pts}</div>
                          {player.pronunciation && (
                            <div className="italic">"{player.pronunciation}"</div>
                          )}
                          {player.stats.fow + player.stats.fol > 0 && (
                            <div>Faceoffs: {faceoffPct}%</div>
                          )}
                          {player.careerStats.gp > 0 && (
                            <div className="text-xs bg-blue-50 px-1 rounded mt-1">
                              Career: {player.careerStats.gp}GP {player.careerStats.g}-{player.careerStats.a}--{player.careerStats.pts}
                            </div>
                          )}
                        </>
                      )}
                      {!compact && isGoalie && player.goalieStats && (
                        <>
                          <div className="font-semibold">{player.goalieStats.w}-{player.goalieStats.l}-{player.goalieStats.t} ({player.goalieStats.gp})</div>
                          <div>GAA {player.goalieStats.gaa.toFixed(2)}</div>
                          {player.pronunciation && (
                            <div className="italic">"{player.pronunciation}"</div>
                          )}
                          <div>SV {player.goalieStats.svp}</div>
                        </>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const LineSlot = ({ line, position, label }) => {
            const player = lines[line][position];
            
            return (
              <div
                onDragOver={(e) => e.preventDefault()}
                onDrop={() => handleDrop(line, position)}
                className="relative"
              >
                <div className="text-xs font-bold text-center mb-1">{label}</div>
                <div className={`border-2 border-dashed rounded p-2 min-h-[120px] flex items-center justify-center ${
                  player ? 'border-gray-400 bg-gray-50' : 'border-gray-300 bg-white'
                }`}>
                  {player ? (
                    <PlayerCard player={player} source={{ line, position }} compact={true} />
                  ) : (
                    <div className="text-gray-400 text-xs">Drop</div>
                  )}
                </div>
              </div>
            );
          };

          const getPlayersInLines = () => {
            const playersInLines = new Set();
            Object.values(lines).forEach(line => {
              Object.values(line).forEach(val => {
                if (val && typeof val === 'object' && val.id) {
                  playersInLines.add(val.id);
                }
              });
            });
            return playersInLines;
          };

          const availablePlayers = myTeamData.roster.filter(p => !getPlayersInLines().has(p.id));
          const currentStepInfo = importSteps.find(s => s.key === importStep);
          
          const normalizeFirstName = (name) => {
            const variations = {
              'joe': 'joseph', 'joseph': 'joe',
              'mike': 'michael', 'michael': 'mike',
              'dan': 'daniel', 'daniel': 'dan',
              'matt': 'matthew', 'matthew': 'matt',
              'rob': 'robert', 'robert': 'rob',
              'tom': 'thomas', 'thomas': 'tom',
              'jim': 'james', 'james': 'jim',
              'will': 'william', 'william': 'will',
              'chris': 'christopher', 'christopher': 'chris',
              'nick': 'nicholas', 'nicholas': 'nick'
            };
            const lower = name.toLowerCase();
            return variations[lower] ? [lower, variations[lower]] : [lower];
          };

          const parseCareerStats = (text) => {
            const lines = text.split('\n').map(l => l.trim());
            const statsMap = new Map();
            
            for (let i = 0; i < lines.length; i++) {
              const line = lines[i];
              
              // Try to match skater stats line (same format as current season)
              const match = line.match(/^(\d+)([A-Za-z\s]+?)(\d+)(\d+)(\d+)(\d+)(\d+)([\d.]+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(\d+)(-?\d+)(\d+)([\d.]+)/);
              
              if (match) {
                const number = match[1];
                const fullName = match[2].trim();
                const nameParts = fullName.split(' ');
                const lastName = nameParts[nameParts.length - 1].toUpperCase();
                const firstName = nameParts.slice(0, -1).join(' ').toUpperCase();
                
                const stats = {
                  number,
                  lastName,
                  firstName,
                  gp: parseInt(match[3]) || 0,
                  g: parseInt(match[4]) || 0,
                  a: parseInt(match[5]) || 0,
                  pts: parseInt(match[6]) || 0,
                  plusMinus: parseInt(match[20]) || 0
                };
                
                if (!statsMap.has(lastName)) {
                  statsMap.set(lastName, []);
                }
                statsMap.get(lastName).push(stats);
              }
            }
            
            return statsMap;
          };

          const matchPlayerToCareerStats = (player, allCareerMaps) => {
            let bestMatch = null;
            
            for (const careerMap of allCareerMaps) {
              const candidates = careerMap.get(player.lastName.toUpperCase());
              if (!candidates) continue;
              
              // Priority 1: Exact first name match
              let match = candidates.find(c => 
                c.firstName.toUpperCase() === player.firstName.toUpperCase()
              );
              
              // Priority 2: First name variations (Joe/Joseph, etc.)
              if (!match) {
                const firstNameVariations = normalizeFirstName(player.firstName);
                match = candidates.find(c => {
                  const candidateVariations = normalizeFirstName(c.firstName);
                  return firstNameVariations.some(v1 => 
                    candidateVariations.some(v2 => v1 === v2)
                  );
                });
              }
              
              // Priority 3: Jersey number match (same last name)
              if (!match) {
                match = candidates.find(c => c.number === player.number);
              }
              
              // Priority 4: If only one player with this last name, use it
              if (!match && candidates.length === 1) {
                match = candidates[0];
              }
              
              if (match && !bestMatch) {
                bestMatch = { gp: 0, g: 0, a: 0, pts: 0, plusMinus: 0 };
              }
              
              if (match) {
                bestMatch.gp += match.gp;
                bestMatch.g += match.g;
                bestMatch.a += match.a;
                bestMatch.pts += match.pts;
                bestMatch.plusMinus += match.plusMinus;
              }
            }
            
            return bestMatch || { gp: 0, g: 0, a: 0, pts: 0, plusMinus: 0 };
          };

          const handleCareerStatsImport = () => {
            const careerMaps = [];
            
            if (careerStatsImport.lastSeason) {
              careerMaps.push(parseCareerStats(careerStatsImport.lastSeason));
            }
            if (careerStatsImport.twoSeasonsAgo) {
              careerMaps.push(parseCareerStats(careerStatsImport.twoSeasonsAgo));
            }
            if (careerStatsImport.threeSeasonsAgo) {
              careerMaps.push(parseCareerStats(careerStatsImport.threeSeasonsAgo));
            }
            
            if (careerMaps.length === 0) {
              alert('Please paste at least one season of stats before importing.');
              return;
            }
            
            const newCareerStats = {};
            myTeamData.roster.forEach(player => {
              if (player.position !== 'G') {
                const careerStats = matchPlayerToCareerStats(player, careerMaps);
                const key = `${player.firstName} ${player.lastName}`;
                newCareerStats[key] = careerStats;
              }
            });
            
            setMyTeamSetup(prev => ({
              ...prev,
              careerStats: newCareerStats
            }));
            
            alert(`Successfully imported career stats for ${Object.keys(newCareerStats).length} players!`);
          };
          
          const totalCoachRecord = {
            w: myTeamData.headCoach.careerRecord.w + myTeamData.record.w,
            l: myTeamData.headCoach.careerRecord.l + myTeamData.record.l,
            t: myTeamData.headCoach.careerRecord.t + myTeamData.record.t
          };
          
          const totalOppCoachRecord = {
            w: opponentData.headCoach.careerRecord.w + opponentData.record.w,
            l: opponentData.headCoach.careerRecord.l + opponentData.record.l,
            t: opponentData.headCoach.careerRecord.t + opponentData.record.t
          };

          return (
            <div className="min-h-screen bg-gray-50">
              {showSetup && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">My Team Setup</h2>
                      <button onClick={() => setShowSetup(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6 space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">Team Name</label>
                        <input
                          type="text"
                          value={myTeamSetup.teamName}
                          onChange={(e) => setMyTeamSetup({...myTeamSetup, teamName: e.target.value})}
                          className="w-full border rounded px-3 py-2"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-semibold mb-1">Arena</label>
                        <input
                          type="text"
                          value={myTeamSetup.arena}
                          onChange={(e) => setMyTeamSetup({...myTeamSetup, arena: e.target.value})}
                          className="w-full border rounded px-3 py-2"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-semibold mb-2">Team Logo</label>
                        <div className="flex gap-2 items-center">
                          {myTeamSetup.logo && (
                            <img src={myTeamSetup.logo} alt="Logo" className="h-16 w-16 object-contain border rounded" />
                          )}
                          <div className="flex-1">
                            <input
                              type="file"
                              accept="image/*"
                              onChange={(e) => handleLogoUpload(e, true, true)}
                              className="text-sm"
                            />
                            <button
                              onClick={() => handleLogoPaste(true, true)}
                              className="mt-2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"
                            >
                              Paste from Clipboard
                            </button>
                          </div>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-1">Primary Color</label>
                          <input
                            type="color"
                            value={myTeamSetup.colors.primary}
                            onChange={(e) => setMyTeamSetup({...myTeamSetup, colors: {...myTeamSetup.colors, primary: e.target.value}})}
                            className="w-full h-10 border rounded cursor-pointer"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-1">Secondary Color</label>
                          <input
                            type="color"
                            value={myTeamSetup.colors.secondary}
                            onChange={(e) => setMyTeamSetup({...myTeamSetup, colors: {...myTeamSetup.colors, secondary: e.target.value}})}
                            className="w-full h-10 border rounded cursor-pointer"
                          />
                        </div>
                      </div>
                    </div>
                    
                    {/* Career Stats Import Section */}
                    <div className="bg-blue-50 p-4 rounded">
                      <h3 className="font-bold mb-2">Career Stats Import</h3>
                      <p className="text-sm mb-3 text-gray-600">Import previous seasons' stats to show career totals (paste from Legacy Player Stats page)</p>
                      
                      <div className="space-y-3">
                        <div>
                          <label className="block text-sm font-semibold mb-1">Last Season Final Player Stats</label>
                          <textarea
                            value={careerStatsImport.lastSeason}
                            onChange={(e) => setCareerStatsImport({...careerStatsImport, lastSeason: e.target.value})}
                            placeholder="Paste player stats from last season..."
                            className="w-full border rounded px-3 py-2 font-mono text-xs"
                            rows="3"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-semibold mb-1">2 Seasons Ago Final Player Stats</label>
                          <textarea
                            value={careerStatsImport.twoSeasonsAgo}
                            onChange={(e) => setCareerStatsImport({...careerStatsImport, twoSeasonsAgo: e.target.value})}
                            placeholder="Paste player stats from 2 seasons ago..."
                            className="w-full border rounded px-3 py-2 font-mono text-xs"
                            rows="3"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-semibold mb-1">3 Seasons Ago Final Player Stats</label>
                          <textarea
                            value={careerStatsImport.threeSeasonsAgo}
                            onChange={(e) => setCareerStatsImport({...careerStatsImport, threeSeasonsAgo: e.target.value})}
                            placeholder="Paste player stats from 3 seasons ago..."
                            className="w-full border rounded px-3 py-2 font-mono text-xs"
                            rows="3"
                          />
                        </div>
                        
                        <button
                          onClick={handleCareerStatsImport}
                          className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm w-full"
                        >
                          Import & Match Career Stats
                        </button>
                      </div>
                    </div>
                    
                    {/* Pronunciation Guide Section */}
                    <div className="bg-purple-50 p-4 rounded mt-4">
                      <h3 className="font-bold mb-2">Player Name Pronunciation Guide</h3>
                      <p className="text-sm mb-3 text-gray-600">Add phonetic pronunciations for player names (optional)</p>
                      
                      <div className="space-y-2 max-h-40 overflow-y-auto">
                        {myTeamData.roster.map((player) => (
                          <div key={player.number} className="flex items-center gap-2">
                            <span className="text-sm font-semibold w-32">#{player.number} {player.name}:</span>
                            <input
                              type="text"
                              value={player.pronunciation || ''}
                              onChange={(e) => {
                                const updatedRoster = myTeamData.roster.map(p => 
                                  p.number === player.number ? {...p, pronunciation: e.target.value} : p
                                );
                                setMyTeamData({...myTeamData, roster: updatedRoster});
                              }}
                              placeholder="e.g., MAK-uh-velli"
                              className="flex-1 border rounded px-2 py-1 text-sm"
                            />
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => setShowSetup(false)}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Save & Close
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {showImport && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <div>
                        <h2 className="text-xl font-bold">Import Data</h2>
                        <p className="text-sm text-gray-600 mt-1">{currentStepInfo?.label}</p>
                      </div>
                      <button onClick={() => setShowImport(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <div className="mb-4 flex gap-1 flex-wrap">
                        {importSteps.map((step, idx) => (
                          <div
                            key={step.key}
                            className={`text-xs px-2 py-1 rounded ${
                              step.key === importStep 
                                ? 'bg-blue-600 text-white' 
                                : 'bg-gray-200 text-gray-600'
                            }`}
                          >
                            {idx + 1}. {step.label}
                          </div>
                        ))}
                      </div>
                      
                      {currentStepInfo?.isLogo ? (
                        <div className="space-y-4">
                          <p className="text-sm">Upload or paste the opponent's logo</p>
                          <div className="flex gap-2 items-center">
                            {opponentLogo && (
                              <img src={opponentLogo} alt="Opponent Logo" className="h-20 w-20 object-contain border rounded" />
                            )}
                            <div>
                              <input
                                type="file"
                                accept="image/*"
                                onChange={(e) => handleLogoUpload(e, false, false)}
                                className="text-sm mb-2"
                              />
                              <button
                                onClick={() => handleLogoPaste(false, false)}
                                className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 block"
                              >
                                Paste from Clipboard
                              </button>
                            </div>
                          </div>
                        </div>
                      ) : (
                        <div>
                          <label className="block text-sm font-semibold mb-2">
                            Paste content from {currentStepInfo?.label}
                          </label>
                          <textarea
                            value={importText}
                            onChange={(e) => setImportText(e.target.value)}
                            placeholder="Paste text here..."
                            className="w-full border rounded px-3 py-2 font-mono text-xs"
                            rows="12"
                          />
                        </div>
                      )}
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-between">
  <div className="flex gap-2">
    {importSteps.findIndex(s => s.key === importStep) > 0 && (
      <button
        onClick={handleBackStep}
        className="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
      >
        Back
      </button>
    )}
    <button
      onClick={handleSkipStep}
      className="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
    >
      Skip Step
    </button>
  </div>
  <button
    onClick={handleImport}
    className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
  >
    {importSteps.findIndex(s => s.key === importStep) === importSteps.length - 1 ? 'Finish' : 'Next Step'}
  </button>
</div>
                  </div>
                </div>
              )}

              {showColorPicker && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
                    <div className="border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">Opponent Colors</h2>
                      <button onClick={() => setShowColorPicker(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6 space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">Primary Color</label>
                        <input
                          type="color"
                          value={opponentColors.primary}
                          onChange={(e) => setOpponentColors({...opponentColors, primary: e.target.value})}
                          className="w-full h-12 border rounded cursor-pointer"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">Secondary Color</label>
                        <input
                          type="color"
                          value={opponentColors.secondary}
                          onChange={(e) => setOpponentColors({...opponentColors, secondary: e.target.value})}
                          className="w-full h-12 border rounded cursor-pointer"
                        />
                      </div>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => setShowColorPicker(false)}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Done
                      </button>
                    </div>
                  </div>
                </div>
              )}

              <div className="no-print bg-gradient-to-r from-blue-900 to-blue-700 text-white p-3 shadow-lg sticky top-0 z-50">
                <div className="max-w-7xl mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    {myTeamSetup.logo && (
                      <img src={myTeamSetup.logo} alt="Team" className="h-10 w-10 object-contain bg-white rounded-full p-1" />
                    )}
                    <h1 className="text-xl font-bold">MSHSL Game </h1>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => setShowSetup(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                      <Settings size={16} /> My Team Setup
                    </button>
                    <button onClick={() => setShowImport(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                      <Upload size={16} /> Import Data
                    </button>
                    <button onClick={() => setShowColorPicker(!showColorPicker)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 text-sm font-semibold">
                       Colors
                    </button>
                    <button onClick={() => window.print()} className="bg-green-600 text-white px-3 py-1.5 rounded hover:bg-green-700 flex items-center gap-1 text-sm font-semibold">
                      <Printer size={16} /> Print
                    </button>
                  </div>
                </div>
              </div>

              <div className="print-page-1 bg-white p-4 max-w-7xl mx-auto">
                <div className="rounded-lg p-3 mb-3" style={{ 
                  background: `linear-gradient(135deg, ${myTeamSetup.colors.primary}20 0%, ${myTeamSetup.colors.secondary}20 100%)`,
                  border: `3px solid ${myTeamSetup.colors.primary}`
                }}>
                  {/* Logos and Coaches Row */}
                  <div className="flex justify-between items-center mb-3 px-4">
                    {/* My Team Logo and Coach */}
                    <div className="text-center">
                      {myTeamSetup.logo && <img src={myTeamSetup.logo} alt="Team" className="h-20 w-20 object-contain mx-auto mb-1" />}
                      <div className="text-sm font-bold">{myTeamData.headCoach.name}</div>
                      <div className="text-xs text-gray-600">(Career: {totalCoachRecord.w}-{totalCoachRecord.l}-{totalCoachRecord.t})</div>
                    </div>
                    
                    {/* Center - Game Number */}
                    <div className="text-center flex-1 mx-4">
                      <div className="text-xs font-semibold text-gray-600 mb-2">Game #{myTeamData.nextGame.gameNum}</div>
                    </div>
                    
                    {/* Opponent Logo and Coach */}
                    <div className="text-center">
                      {opponentLogo && <img src={opponentLogo} alt="Opponent" className="h-20 w-20 object-contain mx-auto mb-1" />}
                      <div className="text-sm font-bold">{opponentData.headCoach.name}</div>
                      <div className="text-xs text-gray-600">(Career: {totalOppCoachRecord.w}-{totalOppCoachRecord.l}-{totalOppCoachRecord.t})</div>
                    </div>
                  </div>
                  
                  {/* Game Title */}
                  <h1 className="text-xl font-black text-center mb-1" style={{ color: myTeamSetup.colors.secondary }}>
                    {myTeamSetup.teamName} ({myTeamData.record.w}-{myTeamData.record.l}-{myTeamData.record.t}, {myTeamData.section}, {myTeamData.conference}) vs {opponentData.teamName ? `${opponentData.teamName} (${opponentData.record.w}-${opponentData.record.l}-${opponentData.record.t}, ${opponentData.section}, ${opponentData.conference})` : '(, , )'}
                  </h1>
                  
                  {/* Game Location */}
<div className="text-sm text-center mb-2">{myTeamData.nextGame.location}</div>
                  
                  <div className="grid grid-cols-4 gap-2 mt-2">
                    <div className="bg-white rounded p-1 shadow-sm">
                      <div className="text-xs font-semibold">Power Play</div>
                      <div className="text-lg font-bold" style={{ color: myTeamSetup.colors.primary }}>{myTeamData.stats.ppPct}%</div>
                      <div className="text-sm" style={{ color: opponentColors.primary }}>{opponentData.stats.ppPct}%</div>
                    </div>
                    <div className="bg-white rounded p-1 shadow-sm">
                      <div className="text-xs font-semibold">Penalty Kill</div>
                      <div className="text-lg font-bold" style={{ color: myTeamSetup.colors.primary }}>{myTeamData.stats.pkPct}%</div>
                      <div className="text-sm" style={{ color: opponentColors.primary }}>{opponentData.stats.pkPct}%</div>
                    </div>
                    <div className="bg-white rounded p-1 shadow-sm">
                      <div className="text-xs font-semibold">Goals/Game</div>
                      <div className="text-lg font-bold" style={{ color: myTeamSetup.colors.primary }}>{myTeamData.stats.gpg.toFixed(2)}</div>
                      <div className="text-sm" style={{ color: opponentColors.primary }}>{opponentData.stats.gpg.toFixed(2)}</div>
                    </div>
                    <div className="bg-white rounded p-1 shadow-sm">
                      <div className="text-xs font-semibold">GA/Game</div>
                      <div className="text-lg font-bold" style={{ color: myTeamSetup.colors.primary }}>{myTeamData.stats.gapg.toFixed(2)}</div>
                      <div className="text-sm" style={{ color: opponentColors.primary }}>{opponentData.stats.gapg.toFixed(2)}</div>
                    </div>
                  </div>
                </div>

                <div className="no-print bg-gray-100 rounded p-2 mb-3">
                  <h2 className="text-sm font-bold mb-2">Available Players ({availablePlayers.length})</h2>
                  <div className="grid grid-cols-5 gap-2">
                    {availablePlayers.map(player => (
                      <PlayerCard key={player.id} player={player} source={{ roster: true }} />
                    ))}
                  </div>
                </div>

                <div className="mb-3">
                  <h2 className="text-lg font-bold mb-2">FORWARD LINES</h2>
                  {['line1', 'line2', 'line3', 'line4'].map((line, idx) => (
                    <div key={line} className={`mb-2 rounded p-2 border-2 ${colorClasses[lines[line].color]}`}>
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-bold text-sm">Line {idx + 1}</span>
                        <select
                          value={lines[line].color}
                          onChange={(e) => handleLineColorChange(line, e.target.value)}
                          className="no-print text-xs border rounded px-1"
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                        <div className="flex-1 grid grid-cols-3 gap-2">
                          <LineSlot line={line} position="lw" label="LW" />
                          <LineSlot line={line} position="c" label="C" />
                          <LineSlot line={line} position="rw" label="RW" />
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <h2 className="text-lg font-bold mb-2">DEFENSE PAIRS</h2>
                    {['d1', 'd2', 'd3'].map((line, idx) => (
                      <div key={line} className="mb-2 bg-gray-100 rounded p-2">
                        <h3 className="font-bold text-sm mb-1">Pair {idx + 1}</h3>
                        <div className="grid grid-cols-2 gap-2">
                          <LineSlot line={line} position="ld" label="LD" />
                          <LineSlot line={line} position="rd" label="RD" />
                        </div>
                      </div>
                    ))}
                  </div>

                  <div>
                    <h2 className="text-lg font-bold mb-2">GOALIES</h2>
                    <div className="space-y-2 mb-3">
                      <LineSlot line="goalies" position="starter" label="Starter" />
                      <LineSlot line="goalies" position="backup" label="Backup" />
                    </div>

                    <div className="bg-yellow-50 border-2 border-yellow-400 rounded p-2 mt-3">
                      <h3 className="font-bold text-sm mb-1">Student Manager</h3>
                      <input
                        type="text"
                        value={myTeamData.studentManager}
                        onChange={(e) => setMyTeamData({...myTeamData, studentManager: e.target.value})}
                        placeholder="Name"
                        className="w-full border rounded px-2 py-1 text-sm"
                      />
                    </div>

                    <div className="bg-red-50 border-2 border-red-400 rounded p-2 mt-2">
                      <h3 className="font-bold text-sm mb-1">Injured/Illness</h3>
                      <textarea
                        value={myTeamData.injuries.join('\n')}
                        onChange={(e) => setMyTeamData({...myTeamData, injuries: e.target.value.split('\n')})}
                        placeholder="Player names (one per line)"
                        className="w-full border rounded px-2 py-1 text-sm"
                        rows="2"
                      />
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3 mt-3">
                  <div className="border-2 rounded p-2" style={{ borderColor: myTeamSetup.colors.primary, background: `${myTeamSetup.colors.primary}10` }}>
                    <h3 className="font-bold mb-1">Tigers PK</h3>
                    <textarea
                      value={coachNotes.pk}
                      onChange={(e) => setCoachNotes({...coachNotes, pk: e.target.value})}
                      placeholder="PK notes..."
                      className="w-full border rounded px-2 py-1 text-sm"
                      rows="3"
                    />
                  </div>
                  <div className="border-2 rounded p-2" style={{ borderColor: myTeamSetup.colors.primary, background: `${myTeamSetup.colors.primary}10` }}>
                    <h3 className="font-bold mb-1">Tigers PP</h3>
                    <textarea
                      value={coachNotes.pp}
                      onChange={(e) => setCoachNotes({...coachNotes, pp: e.target.value})}
                      placeholder="PP notes..."
                      className="w-full border rounded px-2 py-1 text-sm"
                      rows="3"
                    />
                  </div>
                </div>
              </div>

              <div className="print-page-2 bg-white p-4 max-w-7xl mx-auto page-break">
                <div className="rounded-lg p-3 mb-3" style={{ border: `3px solid ${opponentColors.primary}` }}>
                  <h2 className="text-2xl font-black text-center mb-1" style={{ color: opponentColors.primary }}>
                    Opponent: {opponentData.teamName} {opponentData.nickname}
                  </h2>
                  <div className="text-center text-sm font-semibold">
                    Record: {opponentData.record.w}-{opponentData.record.l}-{opponentData.record.t}
                  </div>
                </div>

                <div className="mb-3">
                  <h2 className="text-xl font-bold mb-2" style={{ color: opponentColors.primary }}>Opponent Roster</h2>
                  
                  <div className="mb-2">
                    <h3 className="font-bold mb-1 px-2 py-1 rounded text-sm" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>Forwards</h3>
                    <table className="w-full text-xs border-collapse">
                      <thead>
                        <tr className="bg-gray-200">
                          <th className="border p-1">#</th>
                          <th className="border p-1 text-left">Name</th>
                          <th className="border p-1">Gr</th>
                          <th className="border p-1">GP</th>
                          <th className="border p-1">G</th>
                          <th className="border p-1">A</th>
                          <th className="border p-1">PTS</th>
                          <th className="border p-1">PPG</th>
                          <th className="border p-1">PPA</th>
                          <th className="border p-1">SH</th>
                          <th className="border p-1">SHA</th>
                          <th className="border p-1">PIM</th>
                        </tr>
                      </thead>
                      <tbody>
                        {opponentData.roster
                          .filter(p => p.position === 'F')
                          .sort((a, b) => parseInt(a.number) - parseInt(b.number))
                          .map(player => (
                            <tr key={player.id}>
                              <td className="border p-1 font-bold text-center">{player.number}</td>
                              <td className="border p-1">{player.firstName} {player.lastName}</td>
                              <td className="border p-1 text-center">{player.grade}</td>
                              <td className="border p-1 text-center">{player.stats.gp}</td>
                              <td className="border p-1 text-center">{player.stats.g}</td>
                              <td className="border p-1 text-center">{player.stats.a}</td>
                              <td className="border p-1 text-center font-bold">{player.stats.pts}</td>
                              <td className="border p-1 text-center">{player.stats.ppg}</td>
                              <td className="border p-1 text-center">{player.stats.ppa}</td>
                              <td className="border p-1 text-center">{player.stats.sh}</td>
                              <td className="border p-1 text-center">{player.stats.sha}</td>
                              <td className="border p-1 text-center">{player.stats.pim}</td>
                            </tr>
                          ))}
                      </tbody>
                    </table>
                  </div>

                  <div className="mb-2">
                    <h3 className="font-bold mb-1 px-2 py-1 rounded text-sm" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>Defense</h3>
                    <table className="w-full text-xs border-collapse">
                      <thead>
                        <tr className="bg-gray-200">
                          <th className="border p-1">#</th>
                          <th className="border p-1 text-left">Name</th>
                          <th className="border p-1">Gr</th>
                          <th className="border p-1">GP</th>
                          <th className="border p-1">G</th>
                          <th className="border p-1">A</th>
                          <th className="border p-1">PTS</th>
                          <th className="border p-1">PPG</th>
                          <th className="border p-1">PPA</th>
                          <th className="border p-1">SH</th>
                          <th className="border p-1">SHA</th>
                          <th className="border p-1">PIM</th>
                        </tr>
                      </thead>
                      <tbody>
                        {opponentData.roster
                          .filter(p => p.position === 'D')
                          .sort((a, b) => parseInt(a.number) - parseInt(b.number))
                          .map(player => (
                            <tr key={player.id}>
                              <td className="border p-1 font-bold text-center">{player.number}</td>
                              <td className="border p-1">{player.firstName} {player.lastName}</td>
                              <td className="border p-1 text-center">{player.grade}</td>
                              <td className="border p-1 text-center">{player.stats.gp}</td>
                              <td className="border p-1 text-center">{player.stats.g}</td>
                              <td className="border p-1 text-center">{player.stats.a}</td>
                              <td className="border p-1 text-center font-bold">{player.stats.pts}</td>
                              <td className="border p-1 text-center">{player.stats.ppg}</td>
                              <td className="border p-1 text-center">{player.stats.ppa}</td>
                              <td className="border p-1 text-center">{player.stats.sh}</td>
                              <td className="border p-1 text-center">{player.stats.sha}</td>
                              <td className="border p-1 text-center">{player.stats.pim}</td>
                            </tr>
                          ))}
                      </tbody>
                    </table>
                  </div>

                  <div className="mb-2">
                    <h3 className="font-bold mb-1 px-2 py-1 rounded text-sm" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>Goalies</h3>
                    <table className="w-full text-xs border-collapse">
                      <thead>
                        <tr className="bg-gray-200">
                          <th className="border p-1">#</th>
                          <th className="border p-1 text-left">Name</th>
                          <th className="border p-1">Gr</th>
                          <th className="border p-1">MIN</th>
                          <th className="border p-1">W</th>
                          <th className="border p-1">L</th>
                          <th className="border p-1">T</th>
                          <th className="border p-1">SOG</th>
                          <th className="border p-1">SV</th>
                          <th className="border p-1">GA</th>
                          <th className="border p-1">GAA</th>
                          <th className="border p-1">SV%</th>
                          <th className="border p-1">SO</th>
                        </tr>
                      </thead>
                      <tbody>
                        {opponentData.roster
                          .filter(p => p.position === 'G')
                          .sort((a, b) => parseInt(a.number) - parseInt(b.number))
                          .map(player => (
                            <tr key={player.id}>
                              <td className="border p-1 font-bold text-center">{player.number}</td>
                              <td className="border p-1">{player.firstName} {player.lastName}</td>
                              <td className="border p-1 text-center">{player.grade}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.min || '0:00'}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.w || 0}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.l || 0}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.t || 0}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.sog || 0}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.sv || 0}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.ga || 0}</td>
                              <td className="border p-1 text-center font-bold">{player.goalieStats?.gaa.toFixed(2) || '0.00'}</td>
                              <td className="border p-1 text-center font-bold">{player.goalieStats?.svp || '.000'}</td>
                              <td className="border p-1 text-center">{player.goalieStats?.so || 0}</td>
                            </tr>
                          ))}
                      </tbody>
                    </table>
                  </div>
                </div>

                <div className="mt-3 mb-3">
                  <h2 className="text-xl font-bold mb-2" style={{ color: opponentColors.primary }}>Diagrams & Notes</h2>
                  
                  <div className="border-2 border-dashed border-gray-400 rounded p-3 mb-2 bg-gray-50 min-h-[200px]">
                    <h3 className="font-bold text-sm mb-1">Large Diagram Area</h3>
                    <div className="text-xs text-gray-500 italic">Paste image or add diagram here</div>
                  </div>

                  <div className="grid grid-cols-3 gap-2 mb-3">
                    <div className="border-2 border-dashed border-gray-400 rounded p-2 bg-gray-50 min-h-[150px]">
                      <div className="text-xs text-gray-500 italic">Image 1</div>
                    </div>
                    <div className="border-2 border-dashed border-gray-400 rounded p-2 bg-gray-50 min-h-[150px]">
                      <div className="text-xs text-gray-500 italic">Image 2</div>
                    </div>
                    <div className="border-2 border-dashed border-gray-400 rounded p-2 bg-gray-50 min-h-[150px]">
                      <div className="text-xs text-gray-500 italic">Image 3</div>
                    </div>
                  </div>
                </div>

                {coachNotes.showScoutNotes && (
                  <div className="mt-3">
                    <div className="flex justify-between items-center mb-2">
                      <h2 className="text-xl font-bold" style={{ color: opponentColors.primary }}>Scouting Notes</h2>
                      <button
                        onClick={() => setCoachNotes({...coachNotes, showScoutNotes: false})}
                        className="no-print text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600"
                      >
                        Hide Notes
                      </button>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3">
                      <div className="border-2 border-dashed border-gray-400 rounded p-3 bg-gray-50">
                        <h3 className="font-bold text-sm mb-2">Power Play Setup</h3>
                        <textarea
                          value={coachNotes.scoutNotes.powerPlay}
                          onChange={(e) => setCoachNotes({...coachNotes, scoutNotes: {...coachNotes.scoutNotes, powerPlay: e.target.value}})}
                          placeholder="PP scouting notes..."
                          className="w-full border rounded px-2 py-1 text-xs"
                          rows="6"
                        />
                      </div>
                      <div className="border-2 border-dashed border-gray-400 rounded p-3 bg-gray-50">
                        <h3 className="font-bold text-sm mb-2">Penalty Kill Setup</h3>
                        <textarea
                          value={coachNotes.scoutNotes.penaltyKill}
                          onChange={(e) => setCoachNotes({...coachNotes, scoutNotes: {...coachNotes.scoutNotes, penaltyKill: e.target.value}})}
                          placeholder="PK scouting notes..."
                          className="w-full border rounded px-2 py-1 text-xs"
                          rows="6"
                        />
                      </div>
                    </div>
                    
                    <div className="border-2 border-dashed border-gray-400 rounded p-3 bg-gray-50 mt-3">
                      <h3 className="font-bold text-sm mb-2">Key Players & Tendencies</h3>
                      <textarea
                        value={coachNotes.scoutNotes.keyPlayers}
                        onChange={(e) => setCoachNotes({...coachNotes, scoutNotes: {...coachNotes.scoutNotes, keyPlayers: e.target.value}})}
                        placeholder="Key player notes, tendencies, matchups..."
                        className="w-full border rounded px-2 py-1 text-xs"
                        rows="6"
                      />
                    </div>
                  </div>
                )}

                {!coachNotes.showScoutNotes && (
                  <button
                    onClick={() => setCoachNotes({...coachNotes, showScoutNotes: true})}
                    className="no-print mt-3 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                  >
                    Show Scouting Notes
                  </button>
                )}
              </div>

              <style>{`
                @media print {
                  .no-print {
                    display: none !important;
                  }
                  
                  body {
                    margin: 0;
                    padding: 0;
                  }
                  
                  .print-page-1, .print-page-2 {
                    page-break-after: always;
                    margin: 0.25in;
                  }
                  
                  .print-page-2 {
                    page-break-before: always;
                  }
                  
                  @page {
                    size: portrait;
                    margin: 0.25in;
                  }
                }
                
                .page-break {
                  page-break-before: always;
                }
              `}</style>
            </div>
          );
        };

        ReactDOM.render(<HockeyLinesChart />, document.getElementById('root'));
    </script>
</body>
</html>
